<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>怪獸養成對戰 Demo - 前後端整合</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        /* 怪獸快照區域特定樣式 */
        .monster-snapshot-area {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 0;
            min-height: 230px;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
         @media (min-width: 768px) {
            .monster-snapshot-area {
                min-height: 270px;
            }
        }

        /* 圖層樣式 */
        #monster-snapshot-base-bg,
        #monster-snapshot-body-silhouette,
        #monster-parts-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            object-fit: contain;
        }

        #monster-snapshot-base-bg {
            z-index: 1; /* 最底層 */
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.6; /* 稍微降低背景圖透明度，讓前景更突出 */
        }

        #monster-snapshot-body-silhouette {
            z-index: 2; /* 中間層：怪獸圖 */
            max-width: 65%; /* 調整怪獸圖大小，為DNA框留出更多空間 */
            max-height: 65%;
            /* JS 會更新 src。初始時可以設為透明或極小的佔位符 */
        }

        #monster-parts-container {
            z-index: 3; /* 最頂層：DNA 部位框框 */
            width: 90%;  /* 容器寬度，使其能容納參考圖中的框框佈局 */
            height: 95%; /* 容器高度 */
            display: grid;
            /* 網格佈局參考 unnamed.png */
            /* 估計比例：頭部較小，手臂和腿部較大且在兩側 */
            grid-template-columns: 28% 44% 28%; /* 左(28%) 中(44% - 身體區域) 右(28%) */
            grid-template-rows: 30% 35% 35%;    /* 頭(30%) 手(35%) 腳(35%) */
            grid-template-areas:
                ".    head   ."
                "lArm body rArm"
                "lLeg body rLeg";
            gap: 1%; /* 框框之間的微小間隙 */
            pointer-events: none; /* 部位容器本身不接收點擊 */
        }

        .monster-part {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 100%;
            height: 100%;
            border: 1px dashed var(--border-color); /* 空槽位時的虛線 */
            box-sizing: border-box;
            border-radius: 6px; /* 圓角 */
            display: flex; /* 用於內部可能的內容對齊 */
            align-items: center;
            justify-content: center;
            pointer-events: auto; /* 每個部位框框可以接收事件 (如果未來需要點擊等) */
        }

        .monster-part.empty-part {
            background-image: none !important;
            background-color: rgba(128, 128, 128, 0.1) !important; /* 非常淺的灰色透明背景標示空位 */
            border: 1px dashed var(--border-color);
        }
        /* 當有DNA放入時，邊框可以由 applyDnaItemStyle 控制 */
        .monster-part:not(.empty-part) {
             border: 1px solid transparent; /* 有內容時，邊框由DNA顏色決定或透明 */
        }


        #monster-part-head { grid-area: head; }
        #monster-part-left-arm { grid-area: lArm; }
        #monster-part-right-arm { grid-area: rArm; }
        #monster-part-left-leg { grid-area: lLeg; }
        #monster-part-right-leg { grid-area: rLeg; }
        /* grid-area: body 的區域可以留空，它主要用於佈局對齊 */


        /* 文字資訊疊加層 */
        .snapshot-info-overlay {
            position: absolute;
            bottom: 5px; /* 稍微調整位置 */
            left: 8px;
            right: 8px;
            z-index: 4; /* 確保在所有圖片和框框之上 */
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            pointer-events: none;
        }

        .snapshot-info-left { text-align: left; }
        .snapshot-info-right { text-align: right; }

        #snapshot-achievement-title, #snapshot-nickname, #snapshot-evaluation {
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8); /* 加強文字陰影，提高可讀性 */
        }
        #snapshot-achievement-title {
            font-size: 1rem; /* 調整字體大小 */
            font-weight: bold;
            color: var(--accent-color);
            display: block;
        }
        #snapshot-nickname {
            font-size: 0.75rem; /* 調整字體大小 */
            color: var(--text-secondary);
            display: block;
            margin-top: 2px;
        }
        #snapshot-evaluation {
            font-size: 1rem; /* 調整字體大小 */
            font-weight: bold;
            color: var(--success-color);
        }

        #snapshot-win-loss {
            position: absolute;
            top: 5px; /* 稍微調整位置 */
            right: 8px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            z-index: 4;
            background-color: color-mix(in srgb, var(--bg-panel) 60%, transparent);
            padding: 2px 5px;
            border-radius: 4px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
         #snapshot-win-loss span { display: block; }

        #snapshot-main-content { /* 元素圖標等 */
            position: absolute;
            top: 5px; /* 稍微調整位置 */
            left: 50%;
            transform: translateX(-50%);
            z-index: 4;
            display: flex;
            gap: 4px;
        }
    </style>
</head>
<body>
    <!-- 您的 HTML 結構... -->

    <!-- 怪獸快照面板 -->
    <div class="monster-snapshot-panel panel">
        <div id="monster-snapshot-area" class="monster-snapshot-area">
            <!-- 圖層1: 背景圖 -->
            <img id="monster-snapshot-base-bg" src="https://github.com/msw2004727/MD/blob/main/images/a9f25d4e-9381-4dea-aa33-603afb3d6261.png?raw=true" alt="怪獸快照背景">

            <!-- 圖層2: 怪獸全身圖 (由JS更新src) -->
            <img id="monster-snapshot-body-silhouette" src="" alt="怪獸全身輪廓">

            <!-- 圖層3: 部位圖框框 (由JS更新內容和樣式) -->
            <div id="monster-parts-container">
                <div id="monster-part-head" class="monster-part empty-part"></div>
                <div id="monster-part-left-arm" class="monster-part empty-part"></div>
                <div id="monster-part-right-arm" class="monster-part empty-part"></div>
                <div id="monster-part-left-leg" class="monster-part empty-part"></div>
                <div id="monster-part-right-leg" class="monster-part empty-part"></div>
            </div>

            <!-- 圖層4: 文字資訊疊加層 -->
            <div id="snapshot-main-content" class="snapshot-main-content">
                <!-- JS 會填充屬性圖標 -->
            </div>
            <div id="snapshot-win-loss" class="snapshot-win-loss">
                <span>勝: -</span>
                <span>敗: -</span>
            </div>
            <div class="snapshot-info-overlay">
                <div class="snapshot-info-left">
                    <span id="snapshot-achievement-title">初出茅廬</span>
                    <span id="snapshot-nickname">尚無怪獸</span>
                </div>
                <div class="snapshot-info-right">
                    <span id="snapshot-evaluation">總評價: -</span>
                </div>
            </div>
        </div>
        <div class="top-buttons-container">
            <button id="monster-info-button" class="top-nav-button button" disabled>當前怪獸</button>
            <button id="player-info-button" class="top-nav-button button">玩家資訊</button>
            <button id="show-monster-leaderboard-btn" class="top-nav-button button">怪獸排行</button>
            <button id="show-player-leaderboard-btn" class="top-nav-button button">玩家排行</button>
            <button id="friends-list-btn" class="top-nav-button button">好友名單</button>
            <button id="newbie-guide-btn" class="top-nav-button button">新手上路</button>
        </div>
    </div>

    <!-- ... 其餘 HTML ... -->
    <script src="js/firebase-config.js" defer></script>
    <script src="js/config.js" defer></script>
    <script src="js/game-state.js" defer></script>
    <script src="js/api-client.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/game-logic.js" defer></script> <!-- 確保 game-logic.js 在 ui.js 之前 -->
    <script src="js/ui.js" defer></script>
    <script src="js/event-handlers.js" defer></script>
    <script src="js/main.js" defer></script>
</body>
</html>
